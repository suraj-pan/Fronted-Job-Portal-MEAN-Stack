<app-navbar></app-navbar>

<div class="max-w-7xl mx-auto p-6  bg-gradient-to-b from-blue-50 via-white to-blue-100 ">
  <!-- Header -->
  <div class="flex flex-col sm:flex-row justify-between items-center mb-6">
    <h2 class="text-2xl font-bold text-blue-700 mb-2 sm:mb-0">
      Applications for Job ID:
      <span class="text-gray-800">{{ jobId }}</span>
    </h2>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="text-center py-10">
    <div class="inline-block w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"></div>
    <p class="mt-3 text-gray-600">Loading applications...</p>
  </div>

  <!-- Empty State -->
  <div *ngIf="!loading && !applications.length" class="bg-blue-50 border border-blue-200 text-blue-700 p-4 rounded-lg text-center">
    No applications found for this job.
  </div>

  <!-- Applications Table -->
  <div *ngIf="!loading && applications.length" class="overflow-x-auto bg-white shadow-md rounded-lg">
    <table class="min-w-full text-sm text-gray-700">
      <thead class="bg-blue-600 text-white text-left text-sm uppercase tracking-wide">
      <tr>
        <th class="px-6 py-3">#</th>
        <th class="px-6 py-3">Candidate</th>
        <th class="px-6 py-3">Contact Info</th>
        <th class="px-6 py-3">Skills</th>
        <th class="px-6 py-3">Resume</th>
        <th class="px-6 py-3">Status</th>
        <th class="px-6 py-3">Action</th>
      </tr>
      </thead>

      <tbody>
      <tr *ngFor="let app of applications; index as i"
          class="border-b hover:bg-blue-50 transition-colors duration-200">

        <!-- Index -->
        <td class="px-6 py-3 font-medium text-gray-800">{{ i + 1 }}</td>

        <!-- Candidate -->
        <td class="px-6 py-3">
          <div class="font-semibold text-gray-900">{{ app.applicant?.name }}</div>
          <div class="text-xs text-gray-500">{{ app.createdAt | date:'mediumDate' }}</div>
        </td>

        <!-- Contact -->
        <td class="px-6 py-3">
          <div>{{ app.applicant?.email }}</div>
          <div class="text-gray-500">{{ app.applicant?.phone }}</div>
        </td>

        <!-- Skills -->
        <td class="px-6 py-3">
          <div class="flex flex-wrap gap-2">
              <span *ngFor="let skill of app.applicant?.skills"
                    class="bg-blue-100 text-blue-700 text-xs font-medium px-2 py-1 rounded-full border border-blue-200">
                {{ skill }}
              </span>
          </div>
        </td>

        <!-- Resume -->
        <td class="px-6 py-3">
          <a [href]="'http://localhost:5000' + app.resumeUrl"
             target="_blank"
             class="inline-flex items-center text-sm text-blue-600 hover:underline font-medium">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24"
                 stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M12 4v16m8-8H4"/>
            </svg>
            View Resume
          </a>
        </td>

        <!-- Status -->
        <td class="px-6 py-3">
            <span
              class="px-3 py-1 text-xs font-semibold rounded-full"
              [ngClass]="{
                'bg-yellow-100 text-yellow-700': app.status === 'pending',
                'bg-green-100 text-green-700': app.status === 'selected',
                'bg-red-100 text-red-700': app.status === 'rejected'
              }">
              {{ app.status | titlecase }}
            </span>
        </td>

        <!-- Update Status -->
        <td class="px-6 py-3">
          <select
            #statusSelect
            class="border border-gray-300 rounded-lg text-sm p-1 focus:outline-none focus:ring-2 focus:ring-blue-400"
            [value]="app.status"
            (change)="updateStatus(app, statusSelect.value)">
            <option value="pending">Pending</option>
            <option value="selected">Selected</option>
            <option value="rejected">Rejected</option>
          </select>
        </td>
      </tr>
      </tbody>
    </table>
  </div>
</div>
